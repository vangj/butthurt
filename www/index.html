<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Butt Hurt Report</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    >
    <style>
      body {
        background-color: #f3f4f6;
        font-family: "Helvetica Neue", Arial, sans-serif;
      }

      .sheet {
        background-color: #ffffff;
        border: 2px solid #000;
        margin: 0 auto;
        max-width: 960px;
        padding: 2.5rem 2rem;
      }

      .form-title {
        letter-spacing: 0.08em;
      }

      .info-box {
        border: 1.5px solid #000;
        padding: 1rem 1.25rem;
      }

      .info-label {
        font-size: 0.8rem;
        font-weight: 700;
        letter-spacing: 0.05em;
        text-transform: uppercase;
      }

      .section-title {
        font-size: 1rem;
        font-weight: 700;
        letter-spacing: 0.08em;
        margin-bottom: 1.25rem;
        text-align: center;
        text-transform: uppercase;
      }

      .section-title small {
        display: block;
        font-size: 0.85rem;
        font-weight: 600;
        letter-spacing: 0.04em;
        text-transform: none;
      }

      .form-section {
        border: 1.5px solid #000;
        margin-bottom: 1.5rem;
        padding: 1.5rem;
      }

      .form-label,
      legend {
        font-size: 0.82rem;
        font-weight: 700;
        letter-spacing: 0.04em;
        text-transform: uppercase;
      }

      .form-label {
        margin-bottom: 0.25rem;
      }

      legend {
        float: none;
        margin-bottom: 0.75rem;
        width: auto;
      }

      .question-legend {
        font-size: 0.94rem;
        font-weight: 600;
        letter-spacing: 0.02em;
        text-transform: none;
      }

      .form-control,
      textarea {
        border: 1.5px solid #000;
        border-radius: 0;
        min-height: 3rem;
      }

      textarea {
        min-height: 10rem;
      }

      .form-check-input {
        border: 1.5px solid #000;
        border-radius: 0;
        height: 1.25rem;
        margin-top: 0;
        width: 1.25rem;
      }

      .form-check-input:checked {
        background-color: #000;
        border-color: #000;
      }

      .form-check-label {
        font-size: 0.9rem;
        font-weight: 600;
      }

      .reason-grid .col {
        display: flex;
      }

      .reason-grid .form-check {
        align-items: center;
        display: flex;
        gap: 0.5rem;
        margin-bottom: 0;
        padding: 0.25rem 0 0.25rem 0.75rem;
      }

      @media (max-width: 576px) {
        .sheet {
          padding: 1.75rem 1.25rem;
        }
      }
    </style>
  </head>
  <body>
    <main class="container-fluid py-4">
      <article class="sheet" role="document">
        <header class="text-center mb-4">
          <h1 class="form-title text-uppercase display-6 fw-bold mb-3">Butt Hurt Report</h1>
          <p class="text-uppercase fw-semibold mb-3">Data Required By The Privacy Act Of 1974</p>
          <div class="info-box">
            <div class="row g-4">
              <div class="col-md-6">
                <p class="info-label mb-1">Principal Purpose:</p>
                <p class="mb-0">To assist whiners in documenting hurt feelings.</p>
              </div>
              <div class="col-md-6">
                <p class="info-label mb-1">Routine Uses:</p>
                <p class="mb-0">Leaders &amp; whiners should use this form as necessary.</p>
              </div>
            </div>
          </div>
        </header>

        <form novalidate>
          <section class="form-section" aria-labelledby="part-administrative">
            <h2 class="section-title" id="part-administrative">Part I - Administrative Data</h2>
            <div class="row g-3">
              <div class="col-md-5">
                <label for="part-i-a" class="form-label">A. Whiner's Name (Last, First, MI)</label>
                <input type="text" class="form-control" id="part-i-a" name="part_i_a" autocomplete="name">
              </div>
              <div class="col-md-4">
                <label for="part-i-b" class="form-label">B. Social Security Number</label>
                <input type="text" class="form-control" id="part-i-b" name="part_i_b" inputmode="numeric">
              </div>
              <div class="col-md-3">
                <label for="part-i-c" class="form-label">C. Date Of Report</label>
                <input type="date" class="form-control" id="part-i-c" name="part_i_c">
              </div>
            </div>
            <div class="row g-3">
              <div class="col-md-6">
                <label for="part-i-d" class="form-label">D. Organization</label>
                <input type="text" class="form-control" id="part-i-d" name="part_i_d">
              </div>
              <div class="col-md-6">
                <label for="part-i-e" class="form-label">E. Name &amp; Title Of Person Filling Out This Form</label>
                <input type="text" class="form-control" id="part-i-e" name="part_i_e">
              </div>
            </div>
          </section>

          <section class="form-section" aria-labelledby="part-incident">
            <h2 class="section-title" id="part-incident">Part II - Incident Report</h2>
            <div class="row g-3">
              <div class="col-md-4">
                <label for="part-ii-a" class="form-label">A. Date Feelings Were Hurt</label>
                <input type="date" class="form-control" id="part-ii-a" name="part_ii_a">
              </div>
              <div class="col-md-4">
                <label for="part-ii-b" class="form-label">B. Time Of Hurtfulness</label>
                <input type="time" class="form-control" id="part-ii-b" name="part_ii_b">
              </div>
              <div class="col-md-4">
                <label for="part-ii-c" class="form-label">C. Location Of Hurtful Incident</label>
                <input type="text" class="form-control" id="part-ii-c" name="part_ii_c" autocomplete="off">
              </div>
            </div>
            <div class="row g-3">
              <div class="col-md-6">
                <label for="part-ii-d" class="form-label">D. Name Of Real Man/Woman Who Hurt Your Sensitive Feelings</label>
                <input type="text" class="form-control" id="part-ii-d" name="part_ii_d" autocomplete="name">
              </div>
              <div class="col-md-6">
                <label for="part-ii-e" class="form-label">E. Organization</label>
                <input type="text" class="form-control" id="part-ii-e" name="part_ii_e">
              </div>
            </div>
          </section>

          <section class="form-section" aria-labelledby="part-injury">
            <h2 class="section-title" id="part-injury">Part III - Injury</h2>

            <fieldset class="mb-4">
              <legend class="question-legend">1. Which ear were the words of hurtfulness spoken into?</legend>
              <div class="row g-3">
                <div class="col-sm-4">
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="part_iii_1" id="part-iii-1-left" value="left">
                    <label class="form-check-label" for="part-iii-1-left">Left</label>
                  </div>
                </div>
                <div class="col-sm-4">
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="part_iii_1" id="part-iii-1-right" value="right">
                    <label class="form-check-label" for="part-iii-1-right">Right</label>
                  </div>
                </div>
                <div class="col-sm-4">
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="part_iii_1" id="part-iii-1-both" value="both">
                    <label class="form-check-label" for="part-iii-1-both">Both</label>
                  </div>
                </div>
              </div>
            </fieldset>

            <fieldset class="mb-4">
              <legend class="question-legend">2. Is there permanent feeling damage?</legend>
              <div class="row g-3">
                <div class="col-sm-4">
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="part_iii_2" id="part-iii-2-yes" value="yes">
                    <label class="form-check-label" for="part-iii-2-yes">Yes</label>
                  </div>
                </div>
                <div class="col-sm-4">
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="part_iii_2" id="part-iii-2-no" value="no">
                    <label class="form-check-label" for="part-iii-2-no">No</label>
                  </div>
                </div>
                <div class="col-sm-4">
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="part_iii_2" id="part-iii-2-maybe" value="maybe">
                    <label class="form-check-label" for="part-iii-2-maybe">Maybe</label>
                  </div>
                </div>
              </div>
            </fieldset>

            <fieldset class="mb-4">
              <legend class="question-legend">3. Did you require a &ldquo;tissue&rdquo; for tears?</legend>
              <div class="row g-3">
                <div class="col-sm-4">
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="part_iii_3" id="part-iii-3-yes" value="yes">
                    <label class="form-check-label" for="part-iii-3-yes">Yes</label>
                  </div>
                </div>
                <div class="col-sm-4">
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="part_iii_3" id="part-iii-3-no" value="no">
                    <label class="form-check-label" for="part-iii-3-no">No</label>
                  </div>
                </div>
                <div class="col-sm-4">
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="part_iii_3" id="part-iii-3-multiple" value="multiple">
                    <label class="form-check-label" for="part-iii-3-multiple">Multiple</label>
                  </div>
                </div>
              </div>
            </fieldset>

            <fieldset class="mb-0">
              <legend class="question-legend">4. Has this resulted in a traumatic brain injury?</legend>
              <div class="row g-3">
                <div class="col-sm-4">
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="part_iii_4" id="part-iii-4-yes" value="yes">
                    <label class="form-check-label" for="part-iii-4-yes">Yes</label>
                  </div>
                </div>
                <div class="col-sm-4">
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="part_iii_4" id="part-iii-4-no" value="no">
                    <label class="form-check-label" for="part-iii-4-no">No</label>
                  </div>
                </div>
                <div class="col-sm-4">
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="part_iii_4" id="part-iii-4-maybe" value="maybe">
                    <label class="form-check-label" for="part-iii-4-maybe">Maybe</label>
                  </div>
                </div>
              </div>
            </fieldset>
          </section>

          <section class="form-section" aria-labelledby="part-reason">
            <h2 class="section-title" id="part-reason">Part IV - Reason For Filing This Report (Mark all that apply)</h2>
            <fieldset>
              <legend class="visually-hidden">Select all applicable reasons</legend>
              <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 g-3 reason-grid">
                <div class="col">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="part-iv-1" name="part_iv_1" value="thin_skinned">
                    <label class="form-check-label" for="part-iv-1">I am thin skinned</label>
                  </div>
                </div>
                <div class="col">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="part-iv-2" name="part_iv_2" value="wimp">
                    <label class="form-check-label" for="part-iv-2">I am a wimp</label>
                  </div>
                </div>
                <div class="col">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="part-iv-3" name="part_iv_3" value="hormones">
                    <label class="form-check-label" for="part-iv-3">I have woman/man-like hormones</label>
                  </div>
                </div>
                <div class="col">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="part-iv-4" name="part_iv_4" value="crybaby">
                    <label class="form-check-label" for="part-iv-4">I am a crybaby</label>
                  </div>
                </div>
                <div class="col">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="part-iv-5" name="part_iv_5" value="mommy">
                    <label class="form-check-label" for="part-iv-5">I want my mommy</label>
                  </div>
                </div>
                <div class="col">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="part-iv-6" name="part_iv_6" value="fix_problems">
                    <label class="form-check-label" for="part-iv-6">Someone needs to fix my problems</label>
                  </div>
                </div>
                <div class="col">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="part-iv-7" name="part_iv_7" value="easily_hurt">
                    <label class="form-check-label" for="part-iv-7">My feelings are easily hurt</label>
                  </div>
                </div>
                <div class="col">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="part-iv-8" name="part_iv_8" value="did_not_sign_up">
                    <label class="form-check-label" for="part-iv-8">I didn't sign up for this</label>
                  </div>
                </div>
                <div class="col">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="part-iv-9" name="part_iv_9" value="not_hero">
                    <label class="form-check-label" for="part-iv-9">I was told that I am not a hero</label>
                  </div>
                </div>
                <div class="col">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="part-iv-10" name="part_iv_10" value="weather">
                    <label class="form-check-label" for="part-iv-10">The weather is too cold/hot</label>
                  </div>
                </div>
                <div class="col">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="part-iv-11" name="part_iv_11" value="beers">
                    <label class="form-check-label" for="part-iv-11">Two beers is not enough</label>
                  </div>
                </div>
                <div class="col">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="part-iv-12" name="part_iv_12" value="hands_should_be_in_pockets">
                    <label class="form-check-label" for="part-iv-12">My hands should be in pockets</label>
                  </div>
                </div>
                <div class="col">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="part-iv-13" name="part_iv_13" value="no_post_brief">
                    <label class="form-check-label" for="part-iv-13">I was not offered a post brief</label>
                  </div>
                </div>
                <div class="col">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="part-iv-14" name="part_iv_14" value="requested_post_brief">
                    <label class="form-check-label" for="part-iv-14">Someone requested a post brief</label>
                  </div>
                </div>
                <div class="col">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="part-iv-15" name="part_iv_15" value="all_of_the_above">
                    <label class="form-check-label" for="part-iv-15">All of the above and more</label>
                  </div>
                </div>
              </div>
            </fieldset>
          </section>

          <section class="form-section" aria-labelledby="part-narrative">
            <h2 class="section-title" id="part-narrative">
              <span>Part V - Narrative</span>
              <br>
              <small>(Tell us in your own sissy words how your feelings were hurt.)</small>
            </h2>
            <div>
              <label for="part-v" class="visually-hidden">Narrative Description</label>
              <textarea class="form-control" id="part-v" name="part_v"></textarea>
            </div>
          </section>

          <section class="form-section mb-0" aria-labelledby="part-authentication">
            <h2 class="section-title" id="part-authentication">Part VI - Authentication</h2>
            <div class="row g-3">
              <div class="col-md-6">
                <label for="part-vi-a" class="form-label">A. Printed Name Of Whiner</label>
                <input type="text" class="form-control" id="part-vi-a" name="part_vi_a" autocomplete="name">
              </div>
              <div class="col-md-6">
                <label for="part-vi-b" class="form-label">B. Signature</label>
                <input type="text" class="form-control" id="part-vi-b" name="part_vi_b" autocomplete="off">
              </div>
            </div>
          </section>
          <div class="d-flex justify-content-end mt-4">
            <button type="button" id="generate-btn" class="btn btn-dark btn-lg text-uppercase fw-semibold">Generate</button>
          </div>
        </form>
      </article>
    </main>
    <script type="module">
      import { PDFDocument } from "https://cdn.skypack.dev/pdf-lib@1.17.1?min";

      const groupFieldsByName = (form) => {
        const grouped = new Map();
        for (const field of form.getFields()) {
          const name = field.getName();
          if (!grouped.has(name)) {
            grouped.set(name, []);
          }
          grouped.get(name).push(field);
        }
        return grouped;
      };

      const setTextFields = (form, mappings) => {
        for (const [fieldName, value] of Object.entries(mappings)) {
          const textField = form.getTextField(fieldName);
          textField.setText(value ?? "");
        }
      };

      const setCheckBoxes = (form, mappings) => {
        for (const [fieldName, checked] of Object.entries(mappings)) {
          const checkBox = form.getCheckBox(fieldName);
          if (checked) {
            checkBox.check();
          } else {
            checkBox.uncheck();
          }
        }
      };

      const radioOptionOrder = {
        injury_question1: ["left", "right", "both"],
        injury_question2: ["yes", "no", "maybe"],
        injury_question3: ["yes", "no", "multiple"],
        injury_question4: ["yes", "no", "maybe"]
      };

      const button = document.getElementById("generate-btn");

      const getRadioValue = (name) => {
        const input = document.querySelector(`input[name="${name}"]:checked`);
        return input ? input.value : null;
      };

      button?.addEventListener("click", async () => {
        const originalLabel = button.textContent;
        button.disabled = true;
        button.textContent = "Generating...";
        try {
          const pdfUrl = new URL("blank_form.pdf", window.location.href);
          const response = await fetch(pdfUrl);
          if (!response.ok) {
            throw new Error("Unable to load blank PDF form.");
          }
          const pdfBytes = await response.arrayBuffer();
          const pdfDoc = await PDFDocument.load(pdfBytes, { ignoreEncryption: true });
          const form = pdfDoc.getForm();
          const groupedFields = groupFieldsByName(form);

          setTextFields(form, {
            admin_whiner_name: document.getElementById("part-i-a").value,
            admin_social_security: document.getElementById("part-i-b").value,
            admin_report_date: document.getElementById("part-i-c").value,
            admin_organization: document.getElementById("part-i-d").value,
            admin_preparer_name: document.getElementById("part-i-e").value,
            incident_date: document.getElementById("part-ii-a").value,
            incident_time: document.getElementById("part-ii-b").value,
            incident_location: document.getElementById("part-ii-c").value,
            incident_offender_name: document.getElementById("part-ii-d").value,
            incident_offender_org: document.getElementById("part-ii-e").value,
            narrative_text: document.getElementById("part-v").value,
            auth_whiner_name: document.getElementById("part-vi-a").value,
            auth_whiner_signature: document.getElementById("part-vi-b").value
          });

          setCheckBoxes(form, {
            reason_filing_1: document.getElementById("part-iv-1").checked,
            reason_filing_4: document.getElementById("part-iv-2").checked,
            reason_filing_7: document.getElementById("part-iv-3").checked,
            reason_filing_10: document.getElementById("part-iv-4").checked,
            reason_filing_13: document.getElementById("part-iv-5").checked,
            reason_filing_2: document.getElementById("part-iv-6").checked,
            reason_filing_5: document.getElementById("part-iv-7").checked,
            reason_filing_8: document.getElementById("part-iv-8").checked,
            reason_filing_11: document.getElementById("part-iv-9").checked,
            reason_filing_14: document.getElementById("part-iv-10").checked,
            reason_filing_3: document.getElementById("part-iv-11").checked,
            reason_filing_6: document.getElementById("part-iv-12").checked,
            reason_filing_9: document.getElementById("part-iv-13").checked,
            reason_filing_12: document.getElementById("part-iv-14").checked,
            reason_filing_15: document.getElementById("part-iv-15").checked
          });

          const radioMappings = {
            injury_question1: getRadioValue("part_iii_1"),
            injury_question2: getRadioValue("part_iii_2"),
            injury_question3: getRadioValue("part_iii_3"),
            injury_question4: getRadioValue("part_iii_4")
          };

          for (const [fieldName, selectedValue] of Object.entries(radioMappings)) {
            const options = groupedFields.get(fieldName) ?? [];
            const orderedLabels = radioOptionOrder[fieldName] ?? [];
            options.forEach((optionField, index) => {
              const targetLabel = orderedLabels[index];
              const matches =
                Boolean(selectedValue) && targetLabel === selectedValue.toLowerCase();
              if (matches) {
                optionField.check?.();
              } else {
                optionField.uncheck?.();
              }
            });
          }

          form.flatten();

          const filledBytes = await pdfDoc.save();
          const blob = new Blob([filledBytes], { type: "application/pdf" });
          const downloadUrl = URL.createObjectURL(blob);
          const link = document.createElement("a");
          link.href = downloadUrl;
          link.download = "butthurt.pdf";
          link.click();
          URL.revokeObjectURL(downloadUrl);
        } catch (error) {
          console.error(error);
          alert("We couldn't generate the PDF. Please try again.");
        } finally {
          button.disabled = false;
          button.textContent = originalLabel;
        }
      });
    </script>
  </body>
</html>
